var csrfToken=$('meta[name="csrf_token"]').attr("content");let token="";function onBeforeSendSetToken(ajaxOptions){var token=sessionStorage.getItem("token");ajaxOptions.headers={Authorization:"Bearer "+token}}function onRefreshToken(ajaxOptions){$.ajax({url:"https://localhost:44375/api/RefreshTokenApi/GetRefreshTokens",method:"POST",contentType:"application/json",data:{token:sessionStorage.getItem("token"),refreshToken:sessionStorage.getItem("refreshToken")},success:function(response){sessionStorage.setItem("token",response.token),sessionStorage.setItem("refreshToken",response.refreshToken)}})}const mainFunc={setCookie(name,value,exp,param){var expires="",date,date;"m"==param&&((date=new Date).setTime(date.getTime()+60*exp*1e3),expires="; expires="+date.toUTCString());"d"==param&&((date=new Date).setTime(date.getTime()+24*exp*60*60*1e3),expires="; expires="+date.toUTCString());document.cookie=name+"="+(value||"")+expires+"; path=/"},getCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},eraseCookie(name){document.cookie=name+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},getData:(url,successCallback)=>{$.ajax({type:"GET",url:`${BASE_URL}/${url}`,headers:{csrf_token:csrfToken},dataType:"json",beforeSend:function(xhr){token=mainFunc.getCookie("token"),""!=token&&xhr.setRequestHeader("Authorization","Bearer "+token)},complete:function(){$("#loading").removeClass("block")},success:successCallback,error:function(xhr,textStatus,errorThrown){console.log("error")}})},getDataParam:(url,parameters,successCallback)=>{$.ajax({type:"POST",url:`${BASE_URL}/${url}`,dataType:"JSON",data:parameters,beforeSend:function(xhr){token=mainFunc.getCookie("token"),""!=token&&xhr.setRequestHeader("Authorization","Bearer "+token)},complete:function(){$("#loading").removeClass("block")},success:successCallback,error:function(xhr,textStatus,errorThrown){console.log("error")}})},saveData:(url,dataForm)=>{$.ajax({url:`${BASE_URL}/${url}`,type:"POST",dataType:"JSON",headers:{csrf_token:csrfToken},data:dataForm,processData:!1,contentType:!1,cache:!1,async:!1,beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+token)},success:function(data){200==data.status?Swal.fire("Succesfuly!",data.message,"success"):500==data.status?Swal.fire({icon:"error",title:"Failed!",text:data.message}):Swal.fire({icon:"error",title:"Error!",text:data.message})}})},deleteData(url,parameters,successCallback){Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(result=>{result.isConfirmed&&$.ajax({type:"POST",url:`${BASE_URL}/${url}`,headers:{csrf_token:csrfToken},data:parameters,dataType:"JSON",beforeSend:function(){token=mainFunc.getCookie("token"),""!=token&&xhr.setRequestHeader("Authorization","Bearer "+token)},success:successCallback})})},formatIdr:angka=>{let bilangan,reverse,ribuan=angka.toString().split("").reverse().join("").match(/\d{1,3}/g);return ribuan=ribuan.join(".").split("").reverse().join(""),ribuan},urlify:text=>{let urlRegex=/(https?:\/\/[^\s]+)/g;return text.replace(urlRegex,(function(url){return`<a href="${url}">${url}</a>`}))}},verifyLogin=()=>{$.ajax({type:"POST",url:`${BASE_URL}/api/verify`,headers:{csrf_token:csrfToken},dataType:"json",success:function(result){mainFunc.setCookie("token",result.token,15,"m")},error:function(xhr,textStatus,errorThrown){console.log("error"),window.location.href=BASE_URL+"/login"}})},logout=()=>{$.ajax({type:"GET",url:`${BASE_URL}/api/logout`,headers:{csrf_token:csrfToken},dataType:"json",beforeSend:function(xhr){mainFunc.eraseCookie("token"),mainFunc.eraseCookie("memberPictureSm"),mainFunc.eraseCookie("memberUsername"),mainFunc.eraseCookie("memberLastName"),mainFunc.eraseCookie("memberPicture"),mainFunc.eraseCookie("memberFirstName"),mainFunc.eraseCookie("memberId"),setTimeout(()=>{$("#loading").removeClass("block")},1e3)},success:function(result){200==result.status&&(mainFunc.eraseCookie("token"),mainFunc.eraseCookie("memberPictureSm"),mainFunc.eraseCookie("memberUsername"),mainFunc.eraseCookie("memberLastName"),mainFunc.eraseCookie("memberPicture"),mainFunc.eraseCookie("memberFirstName"),mainFunc.eraseCookie("memberId"),setTimeout(()=>{window.location.href=BASE_URL+"/login"},1e3))},error:function(xhr,textStatus,errorThrown){console.log("error"),verifyLogin()}})};$("#btnLogout").click((function(e){return e.preventDefault(),logout(),!1}));let formLogin=$("#formLogin");if(formLogin.length){let username=formLogin.find("#username"),password=formLogin.find("#password"),loginBtn=formLogin.find("#loginBtn");formLogin.submit((function(e){e.preventDefault(),loginBtn.text("Process login ..."),mainFunc.getDataParam("api/login",{csrf_token:csrfToken,username:username.val(),password:password.val()},(function(result){200==result.status?(mainFunc.setCookie("token",result.token,10,"m"),mainFunc.setCookie("memberId",result.data.id,30,"d"),mainFunc.setCookie("memberUsername",result.data.username,30,"d"),mainFunc.setCookie("memberFirstName",result.data.first_name,30,"d"),mainFunc.setCookie("memberLastName",result.data.last_name,30,"d"),mainFunc.setCookie("memberPicture",result.data.picture,30,"d"),mainFunc.setCookie("memberPictureSm",result.data.picture_sm,30,"d"),loginBtn.text("Login"),setTimeout(()=>{window.location.href=BASE_URL+"/member";let member=mainFunc.getCookie("memberUsername")},1e3),token=result.token):(loginBtn.text("Login"),Swal.fire({icon:"error",title:"Failed!",text:result.message}))}))}))}const header=$("#header"),fullName=header.find("#fullName"),picture=header.find("#picture"),coursesTotal=header.find("#coursesTotal"),coursesInProgress=header.find("#coursesInProgress"),menuLi=$("#menu li"),mobileMenuDashboard=$("#mobileMenuDashboard"),mobileMenuMyCourses=$("#mobileMenuMyCourses"),mobileMenuReviews=$("#mobileMenuReviews"),mobileMenuWebinar=$("#mobileMenuWebinar"),mobileMenuProfile=$("#mobileMenuProfile"),mobileMenuContact=$("#mobileMenuContact"),desktopMenuDashboard=$("#desktopMenuDashboard"),desktopMenuMyCourses=$("#desktopMenuMyCourses"),desktopMenuReviews=$("#desktopMenuReviews"),desktopMenuWebinar=$("#desktopMenuWebinar"),desktopMenuProfile=$("#desktopMenuProfile"),desktopMenuContact=$("#desktopMenuContact"),memberFirstName=mainFunc.getCookie("memberFirstName"),memberLastName=mainFunc.getCookie("memberLastName"),memberFullName=`${mainFunc.getCookie("memberFirstName")} ${mainFunc.getCookie("memberLastName")}`,memberEmail=mainFunc.getCookie("memberEmail"),memberUsername=mainFunc.getCookie("memberUsername"),memberId=mainFunc.getCookie("memberId"),memberPicture=mainFunc.getCookie("memberPicture"),memberPictureSm=mainFunc.getCookie("memberPictureSm"),membersDashboard=$("#membersDashboard"),coursesTable=id=>{mainFunc.getData("api/courses",(function(result){let data=result.data,dataLenght=data.length,html="",no=1,total=0;for(let i=0;i<dataLenght;i++){total=data[i].complete/data[i].total*100;let progress=total.toFixed(2);html+=`\n        <tr>\n          <td style="padding:1rem;"><a href="${BASE_URL}/member/my-courses/${data[i].course_slug}" class="btn btn-sm btn-primary ml-2">Lanjutkan</a></td>\n          <td>\n            <div class="table__box">\n              <img loading="lazy" class="table__img" src="${BASE_URL_IMAGE}/${data[i].thumbnail_sm}" alt="${data[i].course_name}">\n              <div class="table__caption">\n                <p class="table__caption__title">${data[i].course_name}</p>\n                <div>\n                  <p class="progress__caption">${progress}%</p>\n                  <div class="progress">\n                    <div class="progress__value" style="width: ${progress}%"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </td>\n          <td style="padding:1rem;">${data[i].total}</td>\n          <td style="padding:1rem;">${data[i].complete}</td>\n          \n        </tr>\n      `}id.html(html)}))};if(""!=memberPicture&&picture.attr("src",memberPictureSm),membersDashboard.length){const dashboardBodyTable=membersDashboard.find("#dashboardBodyTable"),memberName=membersDashboard.find("#memberName");menuLi.removeClass("active"),desktopMenuDashboard.addClass("active"),mobileMenuDashboard.addClass("active"),memberName.text(memberFullName),setTimeout(()=>{coursesTable(dashboardBodyTable)},1e3)}const coursesProgress=()=>{mainFunc.getData("api/courses-progress",(function(result){const infoCoursesFinished=membersDashboard.find("#infoCoursesFinished"),infoCoursesInProgress=membersDashboard.find("#infoCoursesInProgress"),infoTotalCourses=membersDashboard.find("#infoTotalCourses");membersDashboard.length&&(infoCoursesFinished.text(result.data.coursesFinished),infoCoursesInProgress.text(result.data.coursesInProgress),infoTotalCourses.text(result.data.totalCourses)),coursesInProgress.text(result.data.coursesInProgress),coursesTotal.text(result.data.totalCourses),fullName.text(memberFullName)}))};if(header.length){const mainData=async()=>{await verifyLogin(),setTimeout(()=>{coursesProgress()},500)};mainData()}const myCourse=$("#myCourse"),myCourseBodyTable=myCourse.find("#myCourseBodyTable");myCourse.length&&(menuLi.removeClass("active"),desktopMenuMyCourses.addClass("active"),mobileMenuMyCourses.addClass("active"),setTimeout(()=>{coursesTable(myCourseBodyTable)},1e3));const dataCity=(id,name,provinceId,idCity)=>{$.ajax({type:"GET",url:`https://codingasik.github.io/api-wilayah-indonesia/static/api/regencies/${provinceId.val()}.json`,dataType:"json",success:function(result){console.log(result);let html="";html+='<option value="">Pilih Kota</option>';for(let i=0;i<result.length;i++)html+=`<option value="${result[i].id}">${result[i].name}</option>`;id.html(html),id.change((function(e){e.preventDefault();let valCity=id.find("option:selected").text();idCity.val(id.val()),name.val(valCity)}))},error:function(xhr,textStatus,errorThrown){console.log("error")}})},dataProvinsi=(id,name,idProvince)=>{$.ajax({type:"GET",url:"https://codingasik.github.io/api-wilayah-indonesia/static/api/provinces.json",dataType:"json",success:function(result){console.log(result);let html="";html+='<option value="">Pilih Provinsi</option>';for(let i=0;i<result.length;i++)html+=`<option value="${result[i].id}">${result[i].name}</option>`;id.html(html),id.change((function(e){e.preventDefault();let valProvince=id.find("option:selected").text();idProvince.val(id.val()),name.val(valProvince)}))},error:function(xhr,textStatus,errorThrown){console.log("error")}})},profilePage=$("#profilePage");if(profilePage.length){const formProfile=profilePage.find("#formProfile"),formPassword=profilePage.find("#formPassword");menuLi.removeClass("active"),desktopMenuProfile.addClass("active"),mobileMenuProfile.addClass("active");const firstName=profilePage.find("#firstName"),lastName=profilePage.find("#lastName"),username=profilePage.find("#username"),email=profilePage.find("#email"),gender=profilePage.find("#gender"),male=profilePage.find("#male"),female=profilePage.find("#female"),dob=profilePage.find("#dob"),whatsapp=profilePage.find("#whatsapp"),instagram=profilePage.find("#instagram"),cityId=profilePage.find("#cityId"),cityName=profilePage.find("#cityName"),provinceId=profilePage.find("#provinceId"),provinceName=profilePage.find("#provinceName"),idProvince=profilePage.find("#idProvince"),idCity=profilePage.find("#idCity"),job=profilePage.find("#job"),skill=profilePage.find("#skill"),bio=profilePage.find("#bio"),picture=profilePage.find("#picture"),dataProfile=()=>{mainFunc.getData(`api/profiles/${memberId}`,(function(result){console.log(result),firstName.val(result.data.first_name),lastName.val(result.data.last_name),username.val(result.data.username),email.val(result.data.email),"m"==result.data.gender?male.attr("checked",!0):"f"==result.data.gender&&female.attr("checked",!0),gender.val(result.data.gender),dob.val(result.data.dob),whatsapp.val(result.data.whatsapp),instagram.val(result.data.instagram),idProvince.val(result.data.province_id),provinceName.val(result.data.province_name),idCity.val(result.data.city_id),cityName.val(result.data.city_name),job.val(result.data.job),skill.val(result.data.skill),bio.val(result.data.bio),bio.val(result.data.bio),picture.attr("src",result.data.picture_sm)}))},secondFunction=async()=>{const result=await setTimeout(()=>{dataProfile()},2e3);dataProvinsi(provinceId,provinceName,idProvince),provinceId.on("change",(function(){cityId.removeClass("hidden"),dataCity(cityId,cityName,provinceId,idCity)}))};secondFunction(),formProfile.submit((function(e){e.preventDefault(),mainFunc.saveData(`api/profiles/${memberId}`,new FormData(this))})),formPassword.submit((function(e){e.preventDefault(),mainFunc.saveData(`api/change-password/${memberId}/password`,new FormData(this))}))}const reviewsPage=$("#reviewsPage");if(reviewsPage.length){menuLi.removeClass("active"),desktopMenuReviews.addClass("active"),mobileMenuReviews.addClass("active");const reviewsList=reviewsPage.find("#reviewsList"),pageActive=reviewsPage.find("#pageActive"),totalPage=reviewsPage.find("#totalPage"),reviewsData=()=>{mainFunc.getDataParam("api/reviews",{page:pageActive.val()},(function(result){let html="",data=result.data;if(totalPage.val(Math.ceil(result.totalPage)),0==data.length)html+='\n        <div class="text-center">\n          <p>--Belum ada review--</p>\n          <hr>\n        </div>\n        ';else for(let i=0;i<data.length;i++){if(html+=`\n          <div>\n            <div class="ulasan">\n              <img loading="lazy" class="ulasan__img" src="${data[i].picture_sm}" alt="${data[i].username}" width="60px">\n              <div class="ulasan__box">\n                <div class="ulasan__head">\n                  <div>\n                    <p><strong>${data[i].username}</strong> (${data[i].job})</p>\n                    <small class="ulasan__date">${data[i].review_at}</small>\n                    <p class="ulasan__kelas">Ulasan Kelas : <strong>${data[i].course_name}</strong></p>\n                  </div>\n                  <div class="rating__box">`,1==data[i].rating){html+=`\n            <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_full.svg" alt="">`;for(let f=0;f<4;f++)html+=`\n              <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_empty.svg" alt="">\n            `}else if(2==data[i].rating){for(let f=0;f<2;f++)html+=`\n            <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_full.svg" alt="">`;for(let f=0;f<3;f++)html+=`\n              <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_empty.svg" alt="">\n            `}else if(3==data[i].rating){for(let f=0;f<3;f++)html+=`\n            <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_full.svg" alt="">`;for(let f=0;f<2;f++)html+=`\n              <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_empty.svg" alt="">\n            `}else if(4==data[i].rating){for(let f=0;f<4;f++)html+=`\n            <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_full.svg" alt="">`;for(let f=0;f<1;f++)html+=`\n              <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_empty.svg" alt="">\n            `}else if(5==data[i].rating)for(let f=0;f<5;f++)html+=`\n            <img loading="lazy" class="rating" src="${BASE_URL}/public/members/assets/img/icon/ic_star_full.svg" alt="">`;html+=`</div>\n                </div>\n                <div class="ulasan__body">\n                <p style="line-height:140%">${data[i].review}</p>\n                </div>\n              </div>\n            </div>\n            <hr>\n      \n          </div>\n          `}html+=`\n        \x3c!-- pagination --\x3e\n        <div class="pagination">\n          <p class="pagination__data">\n            Showing <span id="countData">${data.length}</span> of <span id="totalData">${result.totalData}</span> entries\n          </p>\n          <div class="pagination__box">\n            <a onclick="previous()" class="pagination__arrow" href="javascript:;">\n              <img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_left.svg" alt="">\n            </a>`;for(let i=1;i<=totalPage.val();i++)html+='<a class="pagination__page',i==pageActive.val()&&(html+=' active"'),html+=`href="javascript:;" onclick=paginate(${i})><span>${i}</span></a>\n        `;return html+=`<a onclick="next()" class="pagination__arrow" href="javascript:;">\n              <img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_right.svg" alt="">\n            </a>\n          </div>\n        </div>\n      `,reviewsList.html(html),!1}))};function next(){pageActive.val()<totalPage.val()&&(pageActive.val(parseInt(pageActive.val())+1),reviewsData())}function paginate(val){pageActive.val()>1&&(pageActive.val(val),reviewsData())}function previous(){pageActive.val()>1&&(pageActive.val(parseInt(pageActive.val())-1),reviewsData())}reviewsData()}const membersWebinar=$("#membersWebinar");if(membersWebinar.length){verifyLogin(),menuLi.removeClass("active"),desktopMenuWebinar.addClass("active"),mobileMenuWebinar.addClass("active");const webinarBodyTable=membersWebinar.find("#webinarBodyTable"),infoWebinarName=membersWebinar.find("#infoWebinarName"),infoWebinarDate=membersWebinar.find("#infoWebinarDate"),modalAddWebinar=membersWebinar.find("#modalAddWebinar"),btnAddWebinar=membersWebinar.find("#btnAddWebinar"),modalAddQuestion=membersWebinar.find("#modalAddQuestion"),modalAddDetail=membersWebinar.find("#modalAddDetail"),formAddWebinar=modalAddWebinar.find("#formAddWebinar"),webinar=modalAddWebinar.find("#webinar"),date=modalAddWebinar.find("#date"),description=modalAddWebinar.find("#description"),formAddQuestion=modalAddQuestion.find("#formAddQuestion"),regId=modalAddQuestion.find("#regId"),review=modalAddQuestion.find("#review"),question=modalAddQuestion.find("#question"),webinarName=modalAddDetail.find("#webinarName"),webinarUrl=modalAddDetail.find("#webinarUrl"),webinarLink=modalAddDetail.find("#webinarLink"),webinarReview=modalAddDetail.find("#webinarReview"),webinarQuestion=modalAddDetail.find("#webinarQuestion"),webinarAnswer=modalAddDetail.find("#webinarAnswer"),webinarInfo=()=>{mainFunc.getData("api/webinar-info",(function(result){infoWebinarName.text(result.webinar),infoWebinarDate.text(`${result.date} | ${result.time} WIB`)}))},webinarList=()=>{mainFunc.getData("api/webinar-list",(function(result){let html="";html+='<option value="">Pilih Webinar</option>';for(let i=0;i<result.length;i++)html+=`<option data-date="${result[i].date}" data-time="${result[i].time}" data-desc="${result[i].description}" value="${result[i].id}">${result[i].webinar}</option>`;webinar.html(html)}))};function modalWebinarClear(){webinar.val(""),date.text("-"),description.text("-")}webinar.change((function(e){e.preventDefault();let tanggal=$("#webinar option:selected").attr("data-date"),time=$("#webinar option:selected").attr("data-time"),desc=$("#webinar option:selected").attr("data-desc");date.text(`${tanggal} - ${time}`),description.text(`${desc}`)})),btnAddWebinar.click((function(e){e.preventDefault(),webinarList(),modalWebinarClear(),modalAddWebinar.addClass("flex").removeClass("hidden")}));const webinarTable=()=>{mainFunc.getData("api/webinar",(function(result){let data=result.data,dataLenght=data.length,html="",no=1,total=0;for(let i=0;i<dataLenght;i++){total=data[i].complete/data[i].total*100;let info=total.toFixed(2);html+=`\n          <tr>\n            <td>${no++}</td>\n            <td>${data[i].date}</td>\n            <td style="padding: 1rem .5rem;">${data[i].webinar}</td>\n            <td><a href="${data[i].url}" target="_blank">${data[i].url}</a></td>\n            <td>${data[i].review}</td>\n            <td>${data[i].question}</td>\n            <td>${data[i].answer}</td>\n            <td>\n              <button class="btn p-0  btn-success btn-sm mb-1 w-8 " title="Ajukan pertanyaan"  onclick="addQuestion(${data[i].id})">\n                <img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_question.svg" alt="">\n              </button>\n                    \n              <button  class="btn p-0 btn-primary btn-sm w-8" title="Lihat Detail webinar" onclick="detailWebinar(${data[i].id})">\n                <img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_eye.svg" alt="">\n              </button>\n            </td>\n          </tr>\n        `}webinarBodyTable.html(html)}))};function addQuestion(id){modalAddQuestion.addClass("flex").removeClass("hidden"),regId.val(id)}function detailWebinar(id){modalAddDetail.addClass("flex").removeClass("hidden"),mainFunc.getDataParam("api/webinar-detail",{reg_id:id},(function(result){webinarName.text(`${result.webinar}`),webinarUrl.attr("href",result.url),webinarLink.attr("href",result.link),webinarUrl.text(`${result.url}`),webinarLink.text(`${result.link}`),webinarReview.text(`${result.review}`),webinarQuestion.text(`${result.question} ~ At: ${result.question_at}`),webinarAnswer.text(`${result.answer} ~ At: ${result.answer_at}`)}))}webinarInfo(),webinarTable(),formAddWebinar.submit((function(e){e.preventDefault(),mainFunc.getDataParam("api/webinar-add",{list_id:webinar.val()},(function(result){modalAddWebinar.addClass("hidden").removeClass("flex"),"200"==result.status?(Swal.fire("Success",result.message,"success"),webinarTable(),modalWebinarClear()):Swal.fire({icon:"error",title:"Failed",text:result.message})}))})),formAddQuestion.submit((function(e){e.preventDefault(),mainFunc.getDataParam("api/webinar-question",{reg_id:regId.val(),review:review.val(),question:question.val()},(function(result){modalAddQuestion.addClass("hidden").removeClass("flex"),"200"==result.status?(Swal.fire("Success",result.message,"success"),webinarTable(),modalWebinarClear()):Swal.fire({icon:"error",title:"Failed",text:result.message})}))}))}const detailCoursePage=$("#detailCoursePage");if(detailCoursePage.length){verifyLogin();const slug=detailCoursePage.find("#slug"),courseName=detailCoursePage.find("#courseName"),courseTotalVideo=detailCoursePage.find("#courseTotalVideo"),courseTotalTime=detailCoursePage.find("#courseTotalTime"),lessonUrl=detailCoursePage.find("#lessonUrl"),lessonTitle=detailCoursePage.find("#lessonTitle"),deskripsi=detailCoursePage.find("#deskripsi"),download=detailCoursePage.find("#download"),tentang=detailCoursePage.find("#tentang"),page=detailCoursePage.find("#page"),downloadBox=detailCoursePage.find("#downloadBox"),playlistsDetail=detailCoursePage.find("#playlistsDetail"),valProgress=detailCoursePage.find("#valProgress"),formRating=detailCoursePage.find("#formRating"),idTransactionDetail=detailCoursePage.find("#idTransactionDetail"),idMember=detailCoursePage.find("#idMember"),btnReview=detailCoursePage.find("#btnReview"),totalVideo=detailCoursePage.find("#totalVideo"),btnPrevious=detailCoursePage.find("#btnPrevious"),btnNext=detailCoursePage.find("#btnNext"),rating=detailCoursePage.find('[name="rating"]'),review=detailCoursePage.find('[name="review"]'),detailCourseData=()=>{mainFunc.getDataParam("api/courses-detail",{slug:slug.val(),memberId:memberId,page:page.val()},(function(result){const course=result.data.course,playlists=result.data.playlists,files=result.data.files,lessons=result.data.lessons,progress=result.data.progress,hasil=progress.length/course.total_video*100,total=hasil.toFixed(2);totalVideo.val(course.total_video),course.rating>0&&btnReview.attr("disabled","disabled"),1==page.val()?btnPrevious.attr("disabled","disabled"):btnPrevious.removeAttr("disabled"),page.val()==totalVideo.val()?btnNext.attr("disabled","disabled"):btnNext.removeAttr("disabled"),idTransactionDetail.val(course.transaction_detail_id),idMember.val(course.member_id),valProgress.text(total),courseName.text(course.course_name),courseTotalVideo.text(course.total_video),courseTotalTime.text(course.total_time),lessonUrl.attr("src",course.lesson_url),deskripsi.html(`<p>${course.description}</p>`),lessonTitle.text(course.lesson_name),tentang.html(`<p>${course.course_description}</p>`);let html="";for(let i=0;i<files.length;i++)html+=`\n          <div class="detail__download">\n            <p>${files[i].file_name}</p>\n            <div>\n              <small>Noted : ${files[i].note}</small>\n              <a target="_blank" class="btn_link" href="${files[i].file_url}">Download</a>\n            </div>\n          </div>\n        `;downloadBox.html(html);let htmlPlaylist="";for(let m=0;m<playlists.length;m++){htmlPlaylist+=`\n          <div class="materi__box">\n            <div class="flex-between">\n              <p>${playlists[m].playlist_name}</p>\n              <a class="materi`,course.playlist_id===playlists[m].id&&(htmlPlaylist+=" active"),htmlPlaylist+=`" href="javascript:;"><img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_right.svg" alt=""></a>\n            </div>\n            <div class="materi__list`,course.playlist_id===playlists[m].id&&(htmlPlaylist+=" flex"),htmlPlaylist+=' ">';for(let l=0;l<lessons.length;l++)if(playlists[m].id===lessons[l].playlist_id){htmlPlaylist+=`\n                  <a href="javascript:;" onclick="toPage(${l+1})" class="materi__item `,course.id==lessons[l].id&&(htmlPlaylist+=" active "),htmlPlaylist+=`"><div class="materi__item__left" >\n                      <img loading="lazy" src="${BASE_URL}/public/members/assets/img/icon/ic_minus.svg" alt="">\n                      <span class="materi__title ">${lessons[l].lesson_name}</span>\n                    </div>\n                    <div class="materi__item__right">\n                      <small>${lessons[l].duration}</small>\n                      <input title="Check jika telah memahami materi" type="checkbox" name="" id="progressCheck" onclick="addProgress(${lessons[l].id})"`;for(let p=0;p<progress.length;p++)progress[p].lesson_id==lessons[l].id&&(htmlPlaylist+=" checked ");htmlPlaylist+=">\n                    </div>\n                  </a>\n                "}htmlPlaylist+="</div>\n          </div>\n        "}playlistsDetail.html(htmlPlaylist)}))},linkCourseDetail=()=>{setTimeout(()=>{const materi=detailCoursePage.find(".materi"),link=detailCoursePage.find(".tab__link"),content=detailCoursePage.find(".tab__content");for(let i=0;i<link.length;i++)$(link[i]).click((function(e){e.preventDefault();let data=$(this).attr("data-tabs");link.removeClass("active"),$(this).addClass("active"),$(content).addClass("hidden"),$("#"+data).addClass("block"),$("#"+data).removeClass("hidden")}));for(let i=0;i<materi.length;i++)$(materi[i]).click((function(e){e.preventDefault(),$(materi[i]).hasClass("active")?$(materi[i]).removeClass("active"):$(materi[i]).addClass("active");let list=$(this).parent().next();$(list).hasClass("flex")?$(list).removeClass("flex").addClass("hidden"):$(list).removeClass("hidden").addClass("flex")}))},1e3)};function nextLesson(id){parseInt(page.val())+1<=totalVideo.val()&&(page.val(parseInt(page.val())+1),detailCourseData(),linkCourseDetail())}function toPage(num){page.val(num),detailCourseData(),linkCourseDetail()}function previousLesson(id){parseInt(page.val())>1&&(page.val(parseInt(page.val())-1),detailCourseData(),linkCourseDetail())}function addProgress(id){mainFunc.getDataParam("api/add-progress",{lessonId:id,memberId:memberId},(function(result){}))}detailCourseData(),linkCourseDetail(),formRating.submit((function(e){e.preventDefault(),mainFunc.getDataParam("api/reviews-rating",{rating:rating.val(),review:review.val(),idTransactionDetail:idTransactionDetail.val()},(function(result){200==result.status?(Swal.fire("Succesfuly!",result.message,"success"),setTimeout(()=>{window.location.href=BASE_URL+"/member/reviews"},2e3)):500==result.status?Swal.fire({icon:"error",title:"Failed!",text:result.message}):Swal.fire({icon:"error",title:"Error!",text:result.message})}))}))}const alertPayment=param=>{switch(param){case"pending":Swal.fire("Transaksi pending","Segera lakukan proses pembayaran","success");break;case"settlement":Swal.fire({title:"Transaksi telah dibayar",text:"Login ke member area?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Login"}).then(data=>{data.isConfirmed&&(window.location.href=BASE_URL+"/login")});break;case"expire":Swal.fire({title:"Trasaction Expired",text:"Lakukan transaksi ulang?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"transaksi ulang"}).then(data=>{data.isConfirmed&&(window.location.href=BASE_URL+"/repayment")})}},checkoutPage=$("#checkoutPage");if(checkoutPage.length){const formCheckout=checkoutPage.find("#formCheckout"),formCheckStatus=checkoutPage.find("#formCheckStatus"),email=checkoutPage.find("#email"),picture=checkoutPage.find("#picture"),username=checkoutPage.find("#username"),firstName=checkoutPage.find("#firstName"),lastName=checkoutPage.find("#lastName"),password=checkoutPage.find("#password"),whatsapp=checkoutPage.find("#whatsapp"),transactionCode=checkoutPage.find("#transactionCode"),alertUsername=checkoutPage.find("#alertUsername"),kupon=checkoutPage.find("#kupon"),firstPrice=checkoutPage.find("#firstPrice"),totalPrice=checkoutPage.find("#totalPrice"),totalPriceText=checkoutPage.find("#totalPriceText"),totalPriceDesc=checkoutPage.find("#totalPriceDesc"),validUsername=checkoutPage.find("#validUsername"),btnPayment=checkoutPage.find("#btnPayment"),courseId=checkoutPage.find("#courseId");function hasWhiteSpace(s){return s.indexOf(" ")>=0}function checkData(){mainFunc.getDataParam("api/check-members",{username:username.val()},(function(result){let space;0==hasWhiteSpace(username.val())?400==result.status?(alertUsername.html('\n            <small class="text-success">Note: username bisa digunakan.</small>\n          '),validUsername.val("1")):(alertUsername.html('\n            <small class="text-danger">Note: username tidak bisa digunakan</small>\n          '),validUsername.val("0")):(alertUsername.html('\n          <small class="text-success">Note: username tidak boleh spasi</small>\n        '),validUsername.val("0"))}))}function checkKupon(){"JWDCODINGASIK"==kupon.val()?(totalPrice.val("199000"),totalPriceText.text("Rp 199.000"),totalPriceDesc.text("(Discount Kupon Kode)")):"JWDSPESIAL"==kupon.val()?(totalPrice.val("159000"),totalPriceText.text("Rp 159.000"),totalPriceDesc.text("(Discount Kupon Kode + Pre Launch : akan naik setiap 3hari s.d launching)")):(totalPrice.val("1698000"),totalPriceText.text("Rp 1.698.000"),totalPriceDesc.text(""))}checkKupon(),username.length&&checkData(),formCheckStatus.submit((function(e){e.preventDefault();let data={transactionCode:transactionCode.val()};mainFunc.getDataParam("api/payment-check",data,(function(result){if(200==result.status)switch(result.data.transaction_status){case"pending":alertPayment("pending");break;case"settlement":alertPayment("settlement");const data={order_id:result.data.order_id,status_code:result.data.status_code,status_message:result.data.status_message,fraud_status:result.data.fraud_status,transaction_status:result.data.transaction_status,settlement_time:result.data.settlement_time};mainFunc.getDataParam("api/payment-update",data,(function(result){}));break;case"expire":alertPayment("expire")}else 404==result.status&&Swal.fire({icon:"error",title:"Tidak ditemukan",text:"Periksa kembali kode transaksi kamu"})}))})),formCheckout.submit((function(e){if(e.preventDefault(),0==validUsername.val())return Swal.fire({icon:"error",title:"Peringatan",text:"Username telah digunakan"}),!1;let data={email:email.val(),firstName:firstName.val(),lastName:lastName.val(),picture:picture.val(),whatsapp:whatsapp.val(),totalPrice:totalPrice.val(),courseId:courseId.val(),username:username.val(),password:password.val()};btnPayment.text("Pembayaran diproses ..."),mainFunc.getDataParam("api/payment",data,(function(result){200==result.status?(alertPayment("settlement"),btnPayment.text("Proses Pembayaran")):201==result.status?(btnPayment.text("Proses Pembayaran"),alertPayment("pending")):100==result.status&&snap.pay(result.data,{onPending:function(result){console.log("pending"),console.log(result),mainFunc.setCookie("transactionId",result.order_id,15,"m"),mainFunc.setCookie("pdfUrl",result.pdf_url,15,"m"),mainFunc.setCookie("paymentType",result.payment_type,15,"m"),btnPayment.text("Proses Pembayaran"),Swal.fire("Succesfuly!","Check email dan segera selesaikan pembayaran","success"),setTimeout(()=>{window.location.href=BASE_URL+"/thankyou"},2e3)},onError:function(result){console.log("error"),console.log(result),btnPayment.text("Proses Pembayaran"),Swal.fire({icon:"error",title:"Pembayaran gagal",text:"Coba beberapa saat lagi, atau hubungi kami"})},onClose:function(){console.log("customer closed the popup without finishing the payment"),btnPayment.text("Proses Pembayaran"),Swal.fire({icon:"error",title:"Pembayaran batal",text:"Lakukan pembayaran ulang, jika akan membeli lagi"})}})})),btnPayment.text("Proses Pembayaran")}))}const repaymentPage=$("#repaymentPage");if(repaymentPage.length){const formRepayment=repaymentPage.find("#formRepayment"),formCheckMember=repaymentPage.find("#formCheckMember"),email=repaymentPage.find("#email"),kuponCode=repaymentPage.find("#kuponCode"),boxPayment=repaymentPage.find("#boxPayment"),statusMember=repaymentPage.find("#statusMember"),kupon=repaymentPage.find("#kupon"),totalPrice=repaymentPage.find("#totalPrice"),totalPriceText=repaymentPage.find("#totalPriceText"),totalPriceDesc=repaymentPage.find("#totalPriceDesc"),btnPayment=repaymentPage.find("#btnPayment"),courseId=repaymentPage.find("#courseId");function checkKupon(){"JWDCODINGASIK"==kupon.val()?(totalPrice.val("199000"),totalPriceText.text("Rp 199.000"),totalPriceDesc.text("(Discount Kupon Kode)")):"JWDSPESIAL"==kupon.val()?(totalPrice.val("159000"),totalPriceText.text("Rp 159.000"),totalPriceDesc.text("(Discount Kupon Kode + Pre Launch : akan naik setiap 3hari s.d launching)")):(totalPrice.val("1698000"),totalPriceText.text("Rp 1.698.000"),totalPriceDesc.text(""))}checkKupon(),formCheckMember.submit((function(e){e.preventDefault(),mainFunc.getDataParam("api/check-members",{email:email.val()},(function(result){200==result.status?(kuponCode.removeClass("hidden"),boxPayment.removeClass("hidden"),statusMember.html('<span class="text-success">Data ditemukan</span>')):statusMember.html('<span class="text-danger">Data tidak ditemukan</span>')}))})),formRepayment.submit((function(e){e.preventDefault();let data={email:email.val(),totalPrice:totalPrice.val(),courseId:courseId.val()};btnPayment.text("Pembayaran diproses ..."),mainFunc.getDataParam("api/payment",data,(function(result){200==result.status?(alertPayment("settlement"),kuponCode.addClass("hidden"),boxPayment.addClass("hidden"),btnPayment.text("Proses Pembayaran")):201==result.status?(alertPayment("pending"),kuponCode.addClass("hidden"),boxPayment.addClass("hidden"),btnPayment.text("Proses Pembayaran")):100==result.status&&snap.pay(result.data,{onPending:function(result){console.log("pending"),console.log(result),mainFunc.setCookie("transactionId",result.order_id,15,"m"),mainFunc.setCookie("pdfUrl",result.pdf_url,15,"m"),mainFunc.setCookie("paymentType",result.payment_type,15,"m"),kuponCode.addClass("hidden"),boxPayment.addClass("hidden"),btnPayment.text("Proses Pembayaran"),Swal.fire("Succesfuly!","Check email dan segera selesaikan pembayaran","success"),setTimeout(()=>{window.location.href=BASE_URL+"/thankyou"},2e3)},onError:function(result){console.log("error"),console.log(result),kuponCode.addClass("hidden"),boxPayment.addClass("hidden"),btnPayment.text("Proses Pembayaran"),Swal.fire({icon:"error",title:"Pembayaran gagal",text:"Coba beberapa saat lagi, atau hubungi kami"})},onClose:function(){console.log("customer closed the popup without finishing the payment"),kuponCode.addClass("hidden"),boxPayment.addClass("hidden"),btnPayment.text("Proses Pembayaran"),Swal.fire({icon:"error",title:"Pembayaran batal",text:"Lakukan pembayaran ulang, jika akan membeli lagi"})}})}))}))}const contactPage=$("#contactPage");if(contactPage.length){menuLi.removeClass("active"),desktopMenuContact.addClass("active"),mobileMenuContact.addClass("active");const formContact=contactPage.find("#formContact"),inboxSubject=contactPage.find("#inboxSubject"),inboxMessage=contactPage.find("#inboxMessage"),btnContact=contactPage.find("#btnContact");formContact.submit((function(e){e.preventDefault(),btnContact.text("Proses Kirim..."),mainFunc.getDataParam("api/message",{inboxSubject:inboxSubject.val(),inboxMessage:inboxMessage.val(),memberId:memberId},(function(result){200==result.status?Swal.fire("Terimakasih",result.message,"success"):Swal.fire({icon:"error",title:"Error!",text:result.message}),inboxSubject.val(""),inboxMessage.val(""),btnContact.text("Kirim")}))}))}const forgotPasswordPage=$("#forgotPasswordPage");if(forgotPasswordPage.length){const formLupa=forgotPasswordPage.find("#formLupa"),email=forgotPasswordPage.find("#email"),btnLupa=forgotPasswordPage.find("#btnLupa");formLupa.submit((function(e){e.preventDefault(),btnLupa.text("Proses Kirim..."),mainFunc.getDataParam("api/send-email",{email:email.val()},(function(result){200==result.status?(Swal.fire("Email dikirim",result.message,"success"),setTimeout(()=>{window.location.href=BASE_URL+"/reset-password"},2e3)):400==result.status?Swal.fire("Email gagal dikirim",result.message,"success"):Swal.fire({icon:"error",title:"Gagal",text:result.message}),email.val(""),btnLupa.text("Kirim")}))}))}const resetPasswordPage=$("#resetPasswordPage");if(resetPasswordPage.length){const formReset=resetPasswordPage.find("#formReset"),email=resetPasswordPage.find("#email"),kodeVer=resetPasswordPage.find("#kodeVer"),passNew=resetPasswordPage.find("#passNew"),verPass=resetPasswordPage.find("#verPass"),btnReset=resetPasswordPage.find("#btnReset");formReset.submit((function(e){if(e.preventDefault(),passNew.val()!=verPass.val())return Swal.fire({icon:"error",title:"Gagal",text:"Pastikan Konfirmasi Password benar"}),!1;btnReset.text("Proses reset..."),mainFunc.getDataParam("api/reset-password",{email:email.val(),kodeVer:kodeVer.val(),passNew:passNew.val()},(function(result){200==result.status?(Swal.fire("Succesfuly!",result.message,"success"),email.val(""),kodeVer.val(""),passNew.val(""),verPass.val(""),setTimeout(()=>{window.location.href=BASE_URL+"/login"},2e3)):500==result.status?Swal.fire({icon:"error",title:"Failed!",text:result.message}):Swal.fire({icon:"error",title:"Gagal",text:result.message}),btnReset.text("Reset Password")}))}))}const invoicePage=$("#invoicePage");if(invoicePage.length){const transactionCode=invoicePage.find("#transactionCode"),fullName=invoicePage.find("#fullName"),email=invoicePage.find("#email"),dateBuy=invoicePage.find("#dateBuy"),datePaid=invoicePage.find("#datePaid"),bodyInvoice=invoicePage.find("#bodyInvoice"),code=invoicePage.find("#code");mainFunc.getDataParam("api/invoice",{transactionCode:transactionCode.val()},(function(result){fullName.text(`${result.data.first_name} ${result.data.last_name}`),email.text(result.data.email),dateBuy.text(result.data.transaction_time),datePaid.text(result.data.paid_at),code.text(result.data.transaction_code),bodyInvoice.html(`\n      <tr class="my-4">\n        <td class="p-2">1</td>\n        <td class="text-primary font-semibold">${result.data.course_name}</td>\n        <td>Rp ${mainFunc.formatIdr(result.data.gross_amount)}</td>\n      </tr>\n    `)}))}